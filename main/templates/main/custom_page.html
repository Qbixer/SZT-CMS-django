{% extends 'main/index.html' %} 
{% block content %}
{% load static %}
<script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/adapters/jquery.js' %}"></script>

<script>
    function toggleStuff(id) {
      var div = document.getElementById(id);
      if(div.style.display == 'none')
        div.style.display = 'inline'
      else
        div.style.display = 'none'
    }
    </script>
<div>
  {% if request.session.edit_mode and user.profile.moderator or request.session.edit_mode and user.is_superuser or request.session.edit_mode and user.is_staff %}
    {{title | safe}}
    {% for widget in pageLayouts %}
      <div>
        {{widget.title}}
        {% if widget.content_type.name == 'post' %}
          {% for post in widget.posts %}
            <button onclick="toggleStuff('post{{post.id}}')">button</button>
            {{ post.body | safe }}
            <div id="post{{post.id}}" style="display: none">hidden stuff</div>
          {% endfor %}
          <button onclick="toggleStuff('add_post{{widget.id}}')"><i class="fas fa-plus-square"></i></button>
          <form id="add_post{{widget.id}}" style="display: none" method="post">
            {% csrf_token %}
            {% for field in widget.addPostForm %}
              <p>
                {{ field.label_tag }}<br>
                {{ field }}
                {% if field.help_text %}
                  <small style="color: grey">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                  <p style="color: red">{{ error }}</p>
                {% endfor %}
              </p>
            {% endfor %}
            <input type="submit" name="add_post" value="Add post"/>
          </form>
        {% endif %}
      </div>
    {% endfor %}
    <hr/>                  
    <button onclick="toggleStuff('add_page_layout')"><i class="fas fa-plus-square"></i></button>
    <form id="add_page_layout" style="display: none" method="post">
      {% csrf_token %}
      {{ pageLayoutForm.media }}
      {% for field in pageLayoutForm %}
        <p>
          {{ field.label_tag }}<br>
          {{ field }}
          {% if field.help_text %}
            <small style="color: grey">{{ field.help_text }}</small>
          {% endif %}
          {% for error in field.errors %}
            <p style="color: red">{{ error }}</p>
          {% endfor %}
        </p>
      {% endfor %}
      <input type="submit" name="add_page_layout" value="Add widget"/>
    </form>
  {% else %}
    {{title | safe}}
    {% for widget in pageLayouts %}
      {{widget.title}}
      {% if widget.content_type.name == 'post' %}
        {% for post in widget.posts %}
          {{ post.body | safe }}
        {% endfor %}        
      {% endif %}
    {% endfor %}
  {% endif %}
</div>
{% endblock %}
